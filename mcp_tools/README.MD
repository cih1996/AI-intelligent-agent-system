# MCP Tools å·¥å…·é›†åˆ

è¿™æ˜¯ä¸€ä¸ªåŸºäº Model Context Protocol (MCP) æ ‡å‡†çš„å·¥å…·é›†åˆé¡¹ç›®ã€‚æ¯ä¸ªæ–‡ä»¶å¤¹ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„ MCP å·¥å…·æ’ä»¶ï¼Œå¯ä»¥é€šè¿‡ç»Ÿä¸€çš„æ³¨å†Œä¸­å¿ƒè‡ªåŠ¨å‘ç°å’ŒåŠ è½½ã€‚

## ğŸ“‹ é¡¹ç›®ç»“æ„

```
mcp_tools/
â”œâ”€â”€ registry.py              # MCP å·¥å…·æ³¨å†Œä¸­å¿ƒï¼Œè‡ªåŠ¨æ‰«æå’ŒåŠ è½½æ‰€æœ‰æ’ä»¶
â”œâ”€â”€ mcp_server.py            # æ ‡å‡† MCP æœåŠ¡å™¨å®ç°ï¼ˆç¬¦åˆ MCP åè®®ï¼‰
â”œâ”€â”€ start.py      # å¯åŠ¨è„šæœ¬ï¼Œå°† MCP å·¥å…·æŒ‚è½½ä¸º HTTP æœåŠ¡
â”œâ”€â”€ mcp_tester.py           # äº¤äº’å¼æµ‹è¯•å™¨ï¼Œç”¨äºæ‰‹åŠ¨æµ‹è¯•å•ä¸ª MCP å·¥å…·
â”œâ”€â”€ desktop_assistant/      # æ¡Œé¢æ“ä½œåŠ©æ‰‹å·¥å…·
â”œâ”€â”€ system_tool/            # Windows ç³»ç»Ÿæ“ä½œå·¥å…·
â”œâ”€â”€ todo_tool/             # å¾…åŠäº‹é¡¹ç®¡ç†å·¥å…·
â”œâ”€â”€ task_tool/             # ä»»åŠ¡ç®¡ç†å·¥å…·
â”œâ”€â”€ memory_tool/           # è®°å¿†ç®¡ç†å·¥å…·
â”œâ”€â”€ knowledge_tool/         # çŸ¥è¯†åº“å·¥å…·
â”œâ”€â”€ ui_tool/               # UI æ“ä½œå·¥å…·
â”œâ”€â”€ qq_tool/               # QQ å·¥å…·
â”œâ”€â”€ tron_tool/             # Tron å·¥å…·
â””â”€â”€ web_douyin/            # æŠ–éŸ³ç½‘é¡µå·¥å…·
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æ‰€æœ‰ MCP å·¥å…·æœåŠ¡å™¨

å¯åŠ¨æ‰€æœ‰å·²æ‰«æåˆ°çš„ MCP å·¥å…·ï¼Œæ¯ä¸ªå·¥å…·ä¼šåˆ†é…ä¸åŒçš„ç«¯å£ï¼š

```bash
python start.py --host 0.0.0.0 --base-port 8000
```

**å‚æ•°è¯´æ˜ï¼š**
- `--host`: ç›‘å¬åœ°å€ï¼ˆé»˜è®¤: `127.0.0.1`ï¼Œä½¿ç”¨ `0.0.0.0` å…è®¸å¤–ç½‘è®¿é—®ï¼‰
- `--base-port`: åŸºç¡€ç«¯å£å·ï¼ˆé»˜è®¤: `8000`ï¼Œæ¯ä¸ªæ’ä»¶ä¼šä»åŸºç¡€ç«¯å£å¼€å§‹é€’å¢åˆ†é…ï¼‰
- `--plugin`: å¯é€‰ï¼ŒæŒ‡å®šè¦å¯åŠ¨çš„å•ä¸ªæ’ä»¶åç§°

**ç¤ºä¾‹ï¼š**
```bash
# å¯åŠ¨æ‰€æœ‰æ’ä»¶
python start.py --host 0.0.0.0 --base-port 8000

# åªå¯åŠ¨ system_tool æ’ä»¶
python start.py --plugin system_tool --host 0.0.0.0 --port 8000
```

å¯åŠ¨æˆåŠŸåï¼Œæ¯ä¸ªæ’ä»¶ä¼šæä¾›ä»¥ä¸‹ HTTP ç«¯ç‚¹ï¼š
- `http://host:port/health` - å¥åº·æ£€æŸ¥
- `http://host:port/tools` - å·¥å…·åˆ—è¡¨
- `http://host:port/mcp` - MCP JSON-RPC ç«¯ç‚¹
- `http://host:port/message` - MCP HTTP ä¼ è¾“ç«¯ç‚¹ï¼ˆç”¨äº Cursor streamable-httpï¼‰

### 2. æµ‹è¯• MCP å·¥å…·

ä½¿ç”¨äº¤äº’å¼æµ‹è¯•å™¨æ‰‹åŠ¨æµ‹è¯•å•ä¸ª MCP å·¥å…·ï¼š

```bash
python mcp_tester.py
```

æµ‹è¯•å™¨ä¼šï¼š
1. è‡ªåŠ¨å‘ç°æ‰€æœ‰å·²å¯åŠ¨çš„ MCP æœåŠ¡å™¨
2. åˆ—å‡ºæ‰€æœ‰å¯ç”¨å·¥å…·
3. äº¤äº’å¼è¾“å…¥å‚æ•°
4. æ‰§è¡Œå·¥å…·å¹¶æ˜¾ç¤ºç»“æœ

**æ³¨æ„ï¼š** ä½¿ç”¨æµ‹è¯•å™¨å‰ï¼Œéœ€è¦å…ˆå¯åŠ¨ MCP æœåŠ¡å™¨ï¼Œå¹¶ç¡®ä¿ `mcp.json` é…ç½®æ–‡ä»¶å­˜åœ¨ä¸”åŒ…å«æœåŠ¡å™¨é…ç½®ã€‚

## ğŸ“¦ æ ¸å¿ƒç»„ä»¶è¯´æ˜

### registry.py - MCP å·¥å…·æ³¨å†Œä¸­å¿ƒ

`MCPRegistry` ç±»è´Ÿè´£è‡ªåŠ¨æ‰«æå’ŒåŠ è½½æ‰€æœ‰ MCP æ’ä»¶ï¼š

- **è‡ªåŠ¨æ‰«æ**ï¼šæ‰«æé¡¹ç›®ç›®å½•ä¸‹æ‰€æœ‰åŒ…å« `manifest.json` çš„æ–‡ä»¶å¤¹
- **åŠ¨æ€åŠ è½½**ï¼šåŠ¨æ€å¯¼å…¥æ’ä»¶çš„ `server.py` å¹¶åˆ›å»ºæœåŠ¡å™¨å®ä¾‹
- **å·¥å…·æ³¨å†Œ**ï¼šå°†æ¯ä¸ªå·¥å…·æ³¨å†Œåˆ°ç»Ÿä¸€çš„å·¥å…·æ³¨å†Œè¡¨ä¸­
- **æœåŠ¡å™¨ç®¡ç†**ï¼šæ”¯æŒä¸ºå•ä¸ªæˆ–æ‰€æœ‰æ’ä»¶å¯åŠ¨ HTTP æœåŠ¡å™¨

**ä¸»è¦æ–¹æ³•ï¼š**
- `scan_plugins()` - æ‰«ææ‰€æœ‰æ’ä»¶
- `load_plugin(plugin_name)` - åŠ è½½å•ä¸ªæ’ä»¶
- `load_all_plugins()` - åŠ è½½æ‰€æœ‰æ’ä»¶
- `call_tool(tool_name, arguments)` - è°ƒç”¨å·¥å…·ï¼ˆæœ¬åœ°å¼€å‘ç”¨ï¼‰
- `start(plugin_name, host, port)` - å¯åŠ¨å•ä¸ªæ’ä»¶çš„ HTTP æœåŠ¡å™¨
- `start_all_mcp_servers(host, base_port)` - å¯åŠ¨æ‰€æœ‰æ’ä»¶çš„ HTTP æœåŠ¡å™¨

### mcp_server.py - æ ‡å‡† MCP æœåŠ¡å™¨å®ç°

å®ç°äº†ç¬¦åˆ MCP æ ‡å‡†çš„æœåŠ¡å™¨ï¼š

- **MCPServer**ï¼šæ ¸å¿ƒ MCP æœåŠ¡å™¨ç±»ï¼Œå®ç° JSON-RPC 2.0 åè®®
- **HTTPMCPServer**ï¼šHTTP ä¼ è¾“çš„ MCP æœåŠ¡å™¨ï¼Œæ”¯æŒéƒ¨ç½²åˆ°å¤–ç½‘
- **create_mcp_server_from_plugin()**ï¼šä»æ’ä»¶ä¿¡æ¯åˆ›å»ºæ ‡å‡† MCP æœåŠ¡å™¨

**æ”¯æŒçš„ MCP æ–¹æ³•ï¼š**
- `initialize` - åˆå§‹åŒ–è¿æ¥
- `tools/list` - åˆ—å‡ºæ‰€æœ‰å·¥å…·
- `tools/call` - è°ƒç”¨å·¥å…·
- `ping` - å¥åº·æ£€æŸ¥

### start.py - å¯åŠ¨è„šæœ¬

ç»Ÿä¸€çš„å¯åŠ¨å…¥å£ï¼Œæ”¯æŒï¼š
- å¯åŠ¨æ‰€æœ‰æ’ä»¶æˆ–å•ä¸ªæ’ä»¶
- è‡ªå®šä¹‰ç›‘å¬åœ°å€å’Œç«¯å£
- è‡ªåŠ¨ç«¯å£åˆ†é…

### mcp_tester.py - äº¤äº’å¼æµ‹è¯•å™¨

ç”¨äºæ‰‹åŠ¨æµ‹è¯• MCP å·¥å…·çš„åŠŸèƒ½ï¼š
- åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ MCP æœåŠ¡å™¨
- é€‰æ‹©æœåŠ¡å™¨å’Œå·¥å…·
- äº¤äº’å¼è¾“å…¥å·¥å…·å‚æ•°
- æ‰§è¡Œå·¥å…·å¹¶æ˜¾ç¤ºç»“æœ

## ğŸ”§ å¼€å‘æ–°çš„ MCP å·¥å…·

è¦å¼€å‘æ–°çš„ MCP å·¥å…·ï¼Œåªéœ€åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ï¼Œå¹¶åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

### å¿…éœ€æ–‡ä»¶

#### 1. `manifest.json` - æ’ä»¶å…ƒæ•°æ®

```json
{
  "name": "your-tool-name",
  "version": "1.0.0",
  "description": "å·¥å…·æè¿°",
  "entry": "server.py"
}
```

#### 2. `tool.json` - å·¥å…·å®šä¹‰

```json
{
  "tools": [
    {
      "name": "your_tool.action",
      "description": "å·¥å…·åŠŸèƒ½æè¿°",
      "input_schema": {
        "type": "object",
        "properties": {
          "param1": {
            "type": "string",
            "description": "å‚æ•°æè¿°"
          }
        },
        "required": ["param1"]
      }
    }
  ]
}
```

#### 3. `server.py` - æœåŠ¡å™¨å®ç°

å¿…é¡»åŒ…å« `create_server()` å‡½æ•°ï¼š

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-

from typing import Dict, Any
from pathlib import Path

class YourToolServer:
    """ä½ çš„å·¥å…·æœåŠ¡å™¨"""
    
    def __init__(self, config_dir: Path):
        self.config_dir = config_dir
        self.config_dir.mkdir(parents=True, exist_ok=True)
    
    def call_tool(self, tool_name: str, arguments: Dict[str, Any]) -> Dict[str, Any]:
        """è°ƒç”¨å·¥å…·"""
        if tool_name == "your_tool.action":
            return self._do_action(arguments)
        else:
            return {
                "success": False,
                "content": None,
                "error": f"æœªçŸ¥å·¥å…·: {tool_name}"
            }
    
    def _do_action(self, arguments: Dict[str, Any]) -> Dict[str, Any]:
        """æ‰§è¡Œæ“ä½œ"""
        param1 = arguments.get("param1")
        
        # ä½ çš„ä¸šåŠ¡é€»è¾‘
        result = f"å¤„ç†äº†: {param1}"
        
        return {
            "success": True,
            "content": result,
            "error": None
        }

def create_server(data_dir: str = None) -> YourToolServer:
    """
    åˆ›å»ºæœåŠ¡å™¨å®ä¾‹ï¼ˆMCP è§„èŒƒè¦æ±‚ï¼‰
    
    Args:
        data_dir: æ•°æ®å­˜å‚¨ç›®å½•
        
    Returns:
        YourToolServer å®ä¾‹
    """
    if data_dir:
        config_path = Path(data_dir)
    else:
        plugin_dir = Path(__file__).parent
        project_root = plugin_dir.parent.parent
        config_path = project_root / '.mcp_data' / 'your_tool'
    
    config_path.mkdir(parents=True, exist_ok=True)
    return YourToolServer(config_path)
```

### ç›®å½•ç»“æ„ç¤ºä¾‹

```
your_tool/
â”œâ”€â”€ manifest.json          # æ’ä»¶å…ƒæ•°æ®
â”œâ”€â”€ tool.json             # å·¥å…·å®šä¹‰
â”œâ”€â”€ server.py             # æœåŠ¡å™¨å®ç°ï¼ˆå¿…é¡»åŒ…å« create_server å‡½æ•°ï¼‰
â”œâ”€â”€ config.json           # å¯é€‰ï¼šé…ç½®æ–‡ä»¶
â””â”€â”€ README.md             # å¯é€‰ï¼šå·¥å…·è¯´æ˜æ–‡æ¡£
```

### å·¥å…·è¿”å›å€¼æ ¼å¼

å·¥å…·å¤„ç†å‡½æ•°åº”è¿”å›ä»¥ä¸‹æ ¼å¼çš„å­—å…¸ï¼š

```python
{
    "success": True,      # æ˜¯å¦æˆåŠŸ
    "content": {...},     # è¿”å›å†…å®¹ï¼ˆå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å­—å…¸ã€åˆ—è¡¨ç­‰ï¼‰
    "error": None         # é”™è¯¯ä¿¡æ¯ï¼ˆæˆåŠŸæ—¶ä¸º Noneï¼‰
}
```

### è‡ªåŠ¨å‘ç°æœºåˆ¶

`registry.py` ä¼šè‡ªåŠ¨æ‰«ææ‰€æœ‰åŒ…å« `manifest.json` çš„æ–‡ä»¶å¤¹ï¼š
- æ‰«æé¡¹ç›®æ ¹ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•
- æ£€æŸ¥æ˜¯å¦åŒ…å« `manifest.json` æ–‡ä»¶
- è‡ªåŠ¨åŠ è½½ `tool.json` å’Œ `server.py`
- è°ƒç”¨ `create_server()` åˆ›å»ºæœåŠ¡å™¨å®ä¾‹

**æ³¨æ„ï¼š** æ–‡ä»¶å¤¹åç§°ä¸èƒ½ä»¥ `_` å¼€å¤´ï¼ˆä¼šè¢«å¿½ç•¥ï¼‰

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šå¯åŠ¨æ‰€æœ‰å·¥å…·

```bash
# å¯åŠ¨æ‰€æœ‰å·¥å…·ï¼Œç›‘å¬ 0.0.0.0ï¼Œä»ç«¯å£ 8000 å¼€å§‹
python start.py --host 0.0.0.0 --base-port 8000
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
[MCP Registry] å·¥å…·ç›®å½•: D:\å·¥ä½œ\Ai\mcp_tools
[MCP Registry] å‘ç° 10 ä¸ªæ’ä»¶: ['desktop_assistant', 'system_tool', ...]
[MCP Registry] å·²åŠ è½½æ’ä»¶: desktop_assistant (1 ä¸ªå·¥å…·)
...
[MCP Server] desktop-assistant v1.0.0 å·²å¯åŠ¨
[MCP Server] HTTP æœåŠ¡ç›‘å¬: http://0.0.0.0:8000
[MCP Server] å¥åº·æ£€æŸ¥: http://0.0.0.0:8000/health
[MCP Server] å·¥å…·åˆ—è¡¨: http://0.0.0.0:8000/tools
...
```

### ç¤ºä¾‹ 2ï¼šæµ‹è¯•å·¥å…·

```bash
python mcp_tester.py
```

äº¤äº’æµç¨‹ï¼š
1. åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ MCP æœåŠ¡å™¨
2. é€‰æ‹©è¦æµ‹è¯•çš„æœåŠ¡å™¨
3. åˆ—å‡ºè¯¥æœåŠ¡å™¨çš„æ‰€æœ‰å·¥å…·
4. é€‰æ‹©è¦æµ‹è¯•çš„å·¥å…·
5. è¾“å…¥å·¥å…·å‚æ•°
6. æ‰§è¡Œå·¥å…·å¹¶æŸ¥çœ‹ç»“æœ

### ç¤ºä¾‹ 3ï¼šé€šè¿‡ HTTP API è°ƒç”¨å·¥å…·

```bash
# è·å–å·¥å…·åˆ—è¡¨
curl http://localhost:8000/tools

# è°ƒç”¨å·¥å…·ï¼ˆJSON-RPCï¼‰
curl -X POST http://localhost:8000/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "id": 1,
    "method": "tools/call",
    "params": {
      "name": "system.get_windows",
      "arguments": {}
    }
  }'
```

## ğŸ” ç°æœ‰å·¥å…·åˆ—è¡¨

- **desktop_assistant** - æ¡Œé¢æ“ä½œåŠ©æ‰‹ï¼ŒåŸºäº GPT-4o å’Œ JS è„šæœ¬æ‰§è¡Œå¼•æ“
- **system_tool** - Windows ç³»ç»Ÿæ“ä½œå·¥å…·ï¼ˆçª—å£ç®¡ç†ã€é¼ æ ‡é”®ç›˜ã€OCRç­‰ï¼‰
- **todo_tool** - å¾…åŠäº‹é¡¹ç®¡ç†å·¥å…·
- **task_tool** - ä»»åŠ¡ç®¡ç†å·¥å…·
- **memory_tool** - è®°å¿†ç®¡ç†å·¥å…·
- **knowledge_tool** - çŸ¥è¯†åº“å·¥å…·
- **ui_tool** - UI æ“ä½œå·¥å…·
- **qq_tool** - QQ å·¥å…·
- **tron_tool** - Tron å·¥å…·
- **web_douyin** - æŠ–éŸ³ç½‘é¡µå·¥å…·

## ğŸ“š æŠ€æœ¯æ ˆ

- **Python 3.x** - ä¸»è¦å¼€å‘è¯­è¨€
- **aiohttp** - å¼‚æ­¥ HTTP æœåŠ¡å™¨æ¡†æ¶
- **JSON-RPC 2.0** - MCP åè®®åŸºäºçš„é€šä¿¡åè®®
- **Model Context Protocol** - æ ‡å‡† MCP åè®®å®ç°

## ğŸ› ï¸ ä¾èµ–å®‰è£…

```bash
# å®‰è£…æ ¸å¿ƒä¾èµ–
pip install aiohttp

# æ ¹æ®å…·ä½“å·¥å…·å¯èƒ½éœ€è¦å®‰è£…å…¶ä»–ä¾èµ–
# ä¾‹å¦‚ system_tool éœ€è¦ï¼š
pip install pywin32 pyautogui paddleocr pillow
```

## ğŸ” æ•°æ®éš”ç¦»æœºåˆ¶ï¼ˆç³»ç»Ÿçº§å‚æ•°ï¼‰

å¯¹äºéœ€è¦æŒä¹…åŒ–æ•°æ®çš„ MCP å·¥å…·ï¼ˆå¦‚ `todo_tool`ã€`memory_tool`ï¼‰ï¼Œç³»ç»Ÿæ”¯æŒåŸºäºç³»ç»Ÿçº§ä¸Šä¸‹æ–‡å‚æ•°çš„æ•°æ®éš”ç¦»ï¼Œç¡®ä¿å¤šç”¨æˆ·ä½¿ç”¨æ—¶æ•°æ®ä¸ä¼šç›¸äº’å¹²æ‰°ã€‚

### MCP æ ‡å‡†å®ç°

æŒ‰ç…§ MCP æ ‡å‡†ï¼Œç³»ç»Ÿçº§å‚æ•°åº”è¯¥åœ¨ `manifest.json` ä¸­å£°æ˜ï¼Œåœ¨ `mcp.json` ä¸­é…ç½®ï¼š

#### 1. åœ¨ `manifest.json` ä¸­å£°æ˜å¿…éœ€å‚æ•°

å·¥å…·å¼€å‘è€…éœ€è¦åœ¨ `manifest.json` ä¸­å£°æ˜ `requiredContext`ï¼Œå‘Šè¯‰ AI å’Œå®¢æˆ·ç«¯è¿™ä¸ªå·¥å…·éœ€è¦å“ªäº›ç³»ç»Ÿçº§å‚æ•°ï¼š

```json
{
  "name": "todo-tool",
  "version": "1.0.0",
  "description": "å¾…åŠäº‹é¡¹ç®¡ç† MCP å·¥å…·",
  "entry": "server.py",
  "requiredContext": {
    "user_id": {
      "type": "string",
      "description": "ç”¨æˆ·IDï¼Œç”¨äºæ•°æ®éš”ç¦»ã€‚å¿…é¡»åœ¨ mcp.json ä¸­é…ç½®",
      "required": true
    }
  }
}
```

**`requiredContext` å­—æ®µè¯´æ˜ï¼š**
- é”®åï¼šå‚æ•°åç§°ï¼ˆå¦‚ `user_id`ã€`tenant_id`ã€`api_key` ç­‰ï¼‰
- å€¼ï¼šå‚æ•°å®šä¹‰å¯¹è±¡
  - `type`: å‚æ•°ç±»å‹ï¼ˆstring, number, boolean ç­‰ï¼‰
  - `description`: å‚æ•°æè¿°
  - `required`: æ˜¯å¦å¿…éœ€ï¼ˆtrue/falseï¼‰

#### 2. åœ¨ `mcp.json` ä¸­é…ç½®å‚æ•°

å®¢æˆ·ç«¯åœ¨ä½¿ç”¨ MCP å·¥å…·æ—¶ï¼Œå¿…é¡»åœ¨ `mcp.json` ä¸­é…ç½® `requiredContext` å£°æ˜çš„æ‰€æœ‰å¿…éœ€å‚æ•°ï¼š

```json
{
  "mcpServers": {
    "todo-tool": {
      "url": "http://127.0.0.1:8005",
      "transport": "streamable-http",
      "context": {
        "user_id": "administrator"
      }
    },
    "memory-tool": {
      "url": "http://127.0.0.1:8001",
      "transport": "streamable-http",
      "context": {
        "user_id": "administrator",
        "tenant_id": "company-123",
        "workspace_id": "workspace-456"
      }
    }
  }
}
```

**å·¥ä½œåŸç†ï¼š**
1. **å£°æ˜é˜¶æ®µ**ï¼šå·¥å…·åœ¨ `manifest.json` ä¸­å£°æ˜ `requiredContext`ï¼Œå‘Šè¯‰ç³»ç»Ÿéœ€è¦å“ªäº›å‚æ•°
2. **é…ç½®é˜¶æ®µ**ï¼šç”¨æˆ·åœ¨ `mcp.json` ä¸­é…ç½®è¿™äº›å‚æ•°
3. **éªŒè¯é˜¶æ®µ**ï¼šå®¢æˆ·ç«¯åœ¨ `initialize` æ—¶ï¼ŒæœåŠ¡å™¨ä¼šéªŒè¯æ‰€æœ‰å¿…éœ€å‚æ•°æ˜¯å¦æä¾›
4. **éš”ç¦»é˜¶æ®µ**ï¼šæœåŠ¡å™¨åœ¨ä¼šè¯çº§åˆ«ä¿å­˜ä¸Šä¸‹æ–‡ï¼Œæ‰€æœ‰å·¥å…·è°ƒç”¨è‡ªåŠ¨ä½¿ç”¨è¿™äº›å‚æ•°è¿›è¡Œæ•°æ®éš”ç¦»
5. **ä½¿ç”¨é˜¶æ®µ**ï¼šå·¥å…·å®ç°æ—¶ä» `_context` å‚æ•°ä¸­æå–éœ€è¦çš„å­—æ®µï¼Œæ— éœ€æ¯æ¬¡ä¼ é€’

**éªŒè¯æœºåˆ¶ï¼š**
- å¦‚æœ `mcp.json` ä¸­ç¼ºå°‘ `requiredContext` å£°æ˜çš„å¿…éœ€å‚æ•°ï¼ŒæœåŠ¡å™¨ä¼šåœ¨ `initialize` æ—¶è¿”å›é”™è¯¯
- å®¢æˆ·ç«¯ä¼šæ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œæç¤ºéœ€è¦é…ç½®å“ªäº›å‚æ•°

**å¸¸è§ç³»ç»Ÿçº§å‚æ•°ç¤ºä¾‹ï¼š**
- `user_id` - ç”¨æˆ·IDï¼ˆæ•°æ®éš”ç¦»ï¼‰
- `tenant_id` - ç§Ÿæˆ·IDï¼ˆå¤šç§Ÿæˆ·åœºæ™¯ï¼‰
- `workspace_id` - å·¥ä½œç©ºé—´ID
- `api_key` - APIå¯†é’¥ï¼ˆä»˜è´¹/æˆæƒMCPï¼‰
- `license_key` - è®¸å¯è¯å¯†é’¥
- ä»»æ„å…¶ä»–è‡ªå®šä¹‰å­—æ®µï¼ˆåœ¨ `manifest.json` ä¸­å£°æ˜å³å¯ï¼‰

### å‘åå…¼å®¹

ç³»ç»Ÿä»æ”¯æŒæ—§çš„é…ç½®æ ¼å¼ï¼ˆè‡ªåŠ¨è½¬æ¢ä¸º `context` å¯¹è±¡ï¼‰ï¼š

```json
{
  "mcpServers": {
    "todo-tool": {
      "url": "http://127.0.0.1:8005",
      "transport": "streamable-http",
      "user_id": "administrator"
    }
  }
}
```

**æ³¨æ„ï¼š** å¦‚æœå·¥å…·åœ¨ `manifest.json` ä¸­å£°æ˜äº† `requiredContext`ï¼Œå»ºè®®ä½¿ç”¨æ ‡å‡†çš„ `context` å¯¹è±¡æ ¼å¼ã€‚

### å…¶ä»–æ–¹å¼ï¼ˆå…¼å®¹æ€§æ”¯æŒï¼‰

ç³»ç»Ÿè¿˜æ”¯æŒä»¥ä¸‹æ–¹å¼ä¼ é€’ä¸Šä¸‹æ–‡ï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰ï¼š

1. **HTTP è¯·æ±‚å¤´**ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
   ```bash
   # ä½¿ç”¨æ ‡å‡†è¯·æ±‚å¤´
   curl -X POST http://localhost:8000/mcp \
     -H "X-User-ID: user123" \
     -H "Content-Type: application/json" \
     -d '{...}'
   
   # ä½¿ç”¨é€šç”¨ä¸Šä¸‹æ–‡è¯·æ±‚å¤´ï¼ˆæ”¯æŒä»»æ„å­—æ®µï¼‰
   curl -X POST http://localhost:8000/mcp \
     -H "X-Context-User-Id: user123" \
     -H "X-Context-Tenant-Id: tenant456" \
     -H "Content-Type: application/json" \
     -d '{...}'
   ```

2. **å·¥å…·å‚æ•°**ï¼ˆä¸­ç­‰ä¼˜å…ˆçº§ï¼‰
   ```json
   {
     "method": "tools/call",
     "params": {
       "name": "todo.add",
       "arguments": {
         "title": "ä»»åŠ¡",
         "user_id": "user123"
       }
     }
   }
   ```

3. **ä¼šè¯çº§åˆ«**ï¼ˆä» `mcp.json` é…ç½®ä¸­è·å–ï¼Œæœ€ä½ä¼˜å…ˆçº§ï¼‰

### æ•°æ®å­˜å‚¨ç»“æ„

å¯ç”¨æ•°æ®éš”ç¦»åï¼Œæ•°æ®ä¼šæŒ‰ä¸Šä¸‹æ–‡æ ‡è¯†å­˜å‚¨åœ¨ç‹¬ç«‹ç›®å½•ä¸­ã€‚é»˜è®¤ä½¿ç”¨ `user_id` ä½œä¸ºæ ‡è¯†ï¼š

```
.mcp_data/
â”œâ”€â”€ todo_tool/
â”‚   â”œâ”€â”€ todos.json              # é»˜è®¤æ•°æ®ï¼ˆå‘åå…¼å®¹ï¼‰
â”‚   â””â”€â”€ users/
â”‚       â”œâ”€â”€ administrator/
â”‚       â”‚   â””â”€â”€ todos.json      # ç”¨æˆ· administrator çš„æ•°æ®
â”‚       â””â”€â”€ user123/
â”‚           â””â”€â”€ todos.json      # ç”¨æˆ· user123 çš„æ•°æ®
â””â”€â”€ memory_tool/
    â”œâ”€â”€ memory.json             # é»˜è®¤æ•°æ®ï¼ˆå‘åå…¼å®¹ï¼‰
    â””â”€â”€ users/
        â”œâ”€â”€ administrator/
        â”‚   â””â”€â”€ memory.json     # ç”¨æˆ· administrator çš„æ•°æ®
        â””â”€â”€ user123/
            â””â”€â”€ memory.json     # ç”¨æˆ· user123 çš„æ•°æ®
```

**æ³¨æ„ï¼š** å·¥å…·å®ç°å¯ä»¥æ ¹æ®éœ€è¦ä» `_context` ä¸­æå–ä»»æ„å­—æ®µè¿›è¡Œæ•°æ®éš”ç¦»ï¼Œä¸ä»…é™äº `user_id`ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åŸºäº `tenant_id` æˆ– `workspace_id` è¿›è¡Œéš”ç¦»ã€‚

### å‘åå…¼å®¹

- **å¦‚æœæ²¡æœ‰é…ç½®ç”¨æˆ·æ ‡è¯†**ï¼šå·¥å…·ä¼šä½¿ç”¨é»˜è®¤æ•°æ®æ–‡ä»¶ï¼ˆ`todos.json`ã€`memory.json`ï¼‰ï¼Œä¿æŒå‘åå…¼å®¹
- **å¦‚æœé…ç½®äº†ç”¨æˆ·æ ‡è¯†**ï¼šå·¥å…·ä¼šä¸ºæ¯ä¸ªç”¨æˆ·åˆ›å»ºç‹¬ç«‹çš„æ•°æ®ç›®å½•ï¼Œå®ç°æ•°æ®éš”ç¦»

### å®ç°æ•°æ®éš”ç¦»çš„å·¥å…·

ç›®å‰æ”¯æŒæ•°æ®éš”ç¦»çš„å·¥å…·ï¼š
- âœ… `todo_tool` - å¾…åŠäº‹é¡¹ç®¡ç†
- âœ… `memory_tool` - è®°å¿†ç®¡ç†

å…¶ä»–éœ€è¦æ•°æ®éš”ç¦»çš„å·¥å…·å¯ä»¥æŒ‰ç…§ç›¸åŒæ¨¡å¼å®ç°ã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

è¦æ·»åŠ æ–°çš„ MCP å·¥å…·ï¼Œåªéœ€ï¼š
1. åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºæ–°æ–‡ä»¶å¤¹
2. æ·»åŠ  `manifest.json`ã€`tool.json` å’Œ `server.py`
3. è¿è¡Œ `start.py` è‡ªåŠ¨å‘ç°å’ŒåŠ è½½

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issueã€‚

